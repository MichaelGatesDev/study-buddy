<%- include('../../head'); %> <%- include('../navbar'); %>

<div class="container-fluid">
  <div id="alert-container"></div>

  <h2>All Schools</h2>

  <table class="table">
    <thead>
      <tr>
        <th scope="col">School ID</th>
        <th scope="col">Name</th>
        <th scope="col">Website</th>
        <th scope="col">Created</th>
        <th scope="col">Updated</th>
        <th scope="col">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% schools.forEach((school) => { %>
      <tr>
        <th scope="row"><%= school.id %></th>
        <td><%= school.name %></td>
        <td><%= school.website %></td>
        <td><%= school.created_at %></td>
        <td><%= school.updated_at %></td>
        <td>
          <div class="btn-group">
            <button type="button" class="btn btn-danger" onclick="deleteSchool(<%= school.id %>);">
              Delete
            </button>
          </div>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>

<script>
  $(document).ready(() => {});

  const deleteSchool = id => {
    fetch("http://localhost:3000/api/v1/schools/delete/" + id, {
      method: "POST",
    })
      .then(response => response.json())
      .then(json => {
        if (json.error) {
          throw json.error;
        }
        showAlert("success", ["Deleted school!", "ID: " + json["id"], "Name: " + json["name"], "IPEDS: " + json["ipeds"]]);
        $("#school-" + json["id"]).remove();
        console.log("Deleted school!");
        console.log(json);
      })
      .catch(err => {
        showAlert("danger", ["Failed to delete school!", err]);
        console.error("Failed to delete school!");
        console.error(err);
      });
  };

  function showAlert(alertType, contents) {
    const alert = `
<div class="alert alert-${alertType} alert-dismissible fade show" role="alert">
  ${contents.map(msg => msg + "<br>").join("")}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
    `.trim();
    $("#alert-container").empty();
    $("#alert-container").prepend(alert);
  }
</script>

<%- include('../../tail'); %>
