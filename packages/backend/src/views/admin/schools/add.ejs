<%- include('../../head'); %> <%- include('../navbar'); %>

<div class="container-fluid">
  <div id="alert-container"></div>

  <h2>Add School</h2>

  <form id="signup-form">
    <div class="form-group">
      <label for="name">Name</label>
      <input type="name" class="form-control" id="name" name="name" aria-describedby="nameHelp" placeholder="Enter name" />
    </div>
    <div class="form-group">
      <label for="website">Website</label>
      <input type="website" class="form-control" id="website" name="website" placeholder="Website" />
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
    <button type="button" class="btn btn-secondary" onclick="populateRandomly();">
      Randomly Populate
    </button>
    <button type="button" class="btn btn-secondary" onclick="reset();">
      Clear
    </button>
  </form>
</div>

<script>
  $(document).ready(() => {
    reset();
    $("#signup-form").on("submit", function () {
      var name = $("#name").val();
      var website = $("#website").val();

      fetch("http://localhost:3000/api/v1/schools/add", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          name,
          website,
        }),
      })
        .then(response => response.json())
        .then(json => {
          if (json.error) {
            throw json.error;
          }
          showAlert("success", ["Added new school!", "Name: " + json["name"], "Website: " + json["website"]]);
          console.log("Created new school!");
          console.log(json);
        })
        .catch(err => {
          showAlert("danger", ["Failed to add school!", err]);
          console.error("Failed to create school!");
          console.error(err);
        });

      return false; // prevents redirect
    });
  });

  function populateRandomly() {
    const city = faker.address.city();
    $("#name").val(city + " University");
    $("#website").val("https://" + city.replace(/\s/gi, "-").toLowerCase() + ".edu");
  }

  function reset() {
    $("#name").val("");
    $("#website").val("");
  }

  function showAlert(alertType, contents) {
    const alert = `
<div class="alert alert-${alertType} alert-dismissible fade show" role="alert">
  ${contents.map(msg => msg + "<br>").join("")}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
    `.trim();
    $("#alert-container").prepend(alert);
  }
</script>

<%- include('../../tail'); %>
