<%- include('../../head'); %>

<%- include('../navbar'); %>

<div class="container-fluid">
    <h2>Add School</h2>

    <form id="signup-form">
        <div class="form-group">
            <label for="name">Name</label>
            <input type="name" class="form-control" id="name" name="name" aria-describedby="nameHelp" placeholder="Enter name">
        </div>
        <div class="form-group">
            <label for="website">Website</label>
            <input type="website" class="form-control" id="website" name="website" placeholder="Website">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
        <button type="button" class="btn btn-secondary" onclick="populateRandomly();">Randomly Populate</button>
        <button type="button" class="btn btn-secondary" onclick="reset();">Clear</button>
    </form>
</div>

<script>

    $(document).ready(() => {
        reset();
        $("#signup-form").on('submit', function () {
            var name = $("#name").val();
            var website = $("#website").val();

            fetch("http://localhost:8081/api/v1/schools/add", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name,
                    website,
                })
            })
                .then((resp) => resp.json())
                .then((json) => {
                    console.log("Created new school!");
                    console.log(json);
                })
                .catch((err) => {
                    console.error("Failed to create school!");
                    console.error(err);
                });

            return false; // prevents redirect
        });
    });

    function populateRandomly() {
        $('#name').val(randomString(10, false, false) + "@domain.ext");
        $('#website').val("https://" + randomString(8, false, false) + ".edu");
    }

    function reset() {
        $("#name").val("");
        $("#website").val("");
    }

    function randomString(length, uppercaseAlso = true, numbersAlso = true) {
        var result = '';
        let characters = 'abcdefghijklmnopqrstuvwxyz';
        const lettersUpper = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        if (uppercaseAlso) characters += lettersUpper;
        const numbers = '0123456789';
        if (numbersAlso) characters += numbers;
        var charactersLength = characters.length;
        for (var i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        return result;
    }

</script>

<%- include('../../tail'); %>